<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Discussion - Aarohi Agriculture</title>
    <link rel="stylesheet" href="/css/output.css">
</head>
<body class="bg-gradient-to-br from-emerald-50 via-white to-teal-50 min-h-screen">

<%- include('../layouts/header') %>

<div class="max-w-5xl mx-auto px-4 py-12">
    
    <!-- Back Button -->
    <a href="/community" class="inline-flex items-center gap-2 text-emerald-600 hover:text-emerald-700 font-bold mb-8 transition group">
        <svg class="w-6 h-6 group-hover:-translate-x-1 transition-transform" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd"/>
        </svg>
        Back to Community Feed
    </a>

    <!-- Post Card -->
    <div class="bg-white rounded-3xl shadow-2xl overflow-hidden mb-8 border-2 border-emerald-100">
        
        <!-- Post Header -->
        <div class="bg-gradient-to-r from-emerald-500 via-teal-500 to-cyan-500 p-8">
            <div class="flex items-center gap-4">
                <div class="relative">
                    <img src="<%= post.user && post.user.profileImage ? post.user.profileImage : '/images/default-user.svg' %>" 
                         class="w-20 h-20 rounded-full object-cover border-4 border-white shadow-2xl" 
                         alt="<%= post.user ? post.user.name : 'Anonymous' %>">
                    <div class="absolute -bottom-1 -right-1 w-6 h-6 bg-green-400 border-4 border-white rounded-full"></div>
                </div>
                <div class="flex-1">
                    <h2 class="text-3xl font-extrabold text-white mb-1">
                        <%= post.user ? post.user.name : 'Anonymous' %>
                    </h2>
                    <p class="text-emerald-100 text-sm flex items-center gap-2">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                        </svg>
                        Community Member
                    </p>
                </div>
                <div class="bg-white/20 backdrop-blur-lg px-6 py-3 rounded-full">
                    <span class="text-white font-bold text-sm">üìù Post</span>
                </div>
            </div>
        </div>

        <!-- Post Content -->
        <div class="p-8 md:p-12">
            <!-- Post Text -->
            <div class="mb-8">
                <div class="bg-gradient-to-br from-emerald-50 via-teal-50 to-cyan-50 rounded-2xl p-8 border-l-4 border-emerald-500 shadow-inner">
                    <div class="flex items-start gap-4">
                        <div class="bg-emerald-500 p-3 rounded-xl flex-shrink-0">
                            <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
                            </svg>
                        </div>
                        <div class="flex-1">
                            <h3 class="text-sm font-bold text-emerald-800 mb-2 uppercase tracking-wide">Post Content</h3>
                            <p class="text-gray-800 leading-relaxed text-lg whitespace-pre-line"><%= post.text %></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Post Image -->
            <% if (post.image) { %>
            <div class="rounded-2xl overflow-hidden shadow-2xl mb-8 group cursor-pointer" onclick="openImageModal(this.querySelector('img').src)">
                <div class="relative">
                    <img src="<%= post.image %>" alt="Post image" class="w-full h-auto max-h-[600px] object-cover group-hover:scale-105 transition-transform duration-500">
                    <div class="absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity flex items-center justify-center">
                        <svg class="w-16 h-16 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                            <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-emerald-600 to-teal-600 text-white py-2 px-4 text-center text-sm font-semibold">
                    Click to view full size
                </div>
            </div>
            <% } %>

            <!-- Post Stats -->
            <div class="flex items-center gap-6 pt-6 border-t-2 border-gray-100">
                <div class="flex items-center gap-2 text-gray-600">
                    <div class="bg-emerald-100 p-2 rounded-lg">
                        <svg class="w-5 h-5 text-emerald-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <span class="font-bold text-lg"><%= comments && comments.length %></span>
                    <span class="font-semibold">Comments</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Comments Section -->
    <div class="bg-white rounded-3xl shadow-2xl p-8 md:p-12 border-2 border-blue-100">
        
        <!-- Comments Header -->
        <div class="flex items-center gap-4 mb-8 pb-6 border-b-2 border-gray-100">
            <div class="bg-gradient-to-br from-blue-500 to-cyan-500 p-4 rounded-2xl shadow-lg">
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
                </svg>
            </div>
            <div class="flex-1">
                <h2 class="text-3xl font-extrabold text-gray-800 mb-1">üí¨ Comments & Discussion</h2>
                <p class="text-gray-600">
                    <span class="font-bold text-blue-600"><%= comments && comments.length %></span> 
                    <%= comments && comments.length === 1 ? 'response' : 'responses' %> from the community
                </p>
            </div>
        </div>

        <!-- Comments List -->
        <div class="space-y-6 mb-10">
            <% if (!comments || comments.length === 0) { %>
                <div class="text-center py-16 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-3xl border-2 border-blue-200">
                    <div class="w-24 h-24 bg-white rounded-full mx-auto mb-6 flex items-center justify-center shadow-lg">
                        <svg class="w-12 h-12 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 13V5a2 2 0 00-2-2H4a2 2 0 00-2 2v8a2 2 0 002 2h3l3 3 3-3h3a2 2 0 002-2zM5 7a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1zm1 3a1 1 0 100 2h3a1 1 0 100-2H6z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">No Comments Yet</h3>
                    <p class="text-gray-600 text-lg">Be the first to share your thoughts on this post!</p>
                </div>
            <% } else { %>
                <% comments.forEach((c, index) => { %>
                    <div class="comment-card group">
                        <div class="flex gap-4">
                            <img src="<%= c.user && c.user.profileImage ? c.user.profileImage : '/images/default-user.png' %>" 
                                 class="w-14 h-14 rounded-full object-cover flex-shrink-0 border-3 border-emerald-400 shadow-md" 
                                 alt="<%= c.user ? c.user.name : 'Anon' %>">
                            
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <h4 class="font-bold text-gray-800 text-lg"><%= c.user ? c.user.name : 'Anon' %></h4>
                                    <% if (index === 0) { %>
                                        <span class="bg-gradient-to-r from-emerald-500 to-teal-500 text-white text-xs px-3 py-1 rounded-full font-bold shadow-md">
                                            ‚≠ê First Response
                                        </span>
                                    <% } %>
                                    <span class="text-gray-400 text-sm ml-auto">Just now</span>
                                </div>
                                <p class="text-gray-700 leading-relaxed text-lg whitespace-pre-line"><%= c.text %></p>
                            </div>
                        </div>
                    </div>
                <% }); %>
            <% } %>
        </div>

        <!-- Add Comment Form -->
        <div class="border-t-2 border-gray-100 pt-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="bg-emerald-500 p-3 rounded-xl">
                    <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800">Share Your Thoughts</h3>
            </div>
            
            <form action="/community/post/<%= post._id %>/comment" method="POST" class="space-y-4">
                <div class="relative">
                    <textarea 
                        name="text" 
                        rows="4"
                        placeholder="Write your comment here... Share your experience or ask questions"
                        class="w-full px-6 py-4 border-3 border-gray-200 rounded-2xl focus:outline-none focus:border-emerald-500 focus:ring-6 focus:ring-emerald-100 transition resize-none text-lg"
                        required
                    ></textarea>
                </div>
                <div class="flex items-center justify-between">
                    <p class="text-sm text-gray-500 flex items-center gap-2">
                        <svg class="w-4 h-4 text-emerald-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        Your comment helps the community grow
                    </p>
                    <button 
                        type="submit" 
                        class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 hover:from-emerald-700 hover:via-teal-700 hover:to-cyan-700 text-white py-4 px-10 rounded-2xl font-bold text-lg shadow-xl hover:shadow-2xl transition transform hover:scale-105 flex items-center gap-3"
                    >
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"/>
                        </svg>
                        Post Comment
                    </button>
                </div>
            </form>
        </div>

    </div>

</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black/95 backdrop-blur-sm flex items-center justify-center z-50 hidden p-4" onclick="closeImageModal()">
    <button class="absolute top-8 right-8 text-white hover:text-gray-300 transition group">
        <svg class="w-12 h-12 group-hover:rotate-90 transition-transform duration-300" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
        </svg>
    </button>
    <img id="modalImage" src="" class="max-w-full max-h-full object-contain rounded-2xl shadow-2xl">
</div>

<%- include('./layouts/footer') %>

<script>
function openImageModal(src) {
    document.getElementById('modalImage').src = src;
    document.getElementById('imageModal').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
}

function closeImageModal() {
    document.getElementById('imageModal').classList.add('hidden');
    document.body.style.overflow = 'auto';
}

// Close on escape
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') closeImageModal();
});
</script>

<style>
.comment-card {
    background: linear-gradient(135deg, #ffffff, #f0fdf4);
    border-radius: 1.5rem;
    padding: 1.5rem;
    border-left: 5px solid #10b981;
    transition: all 0.3s;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.comment-card:hover {
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.15);
    transform: translateX(8px);
    border-left-color: #059669;
}

.border-3 {
    border-width: 3px;
}
</style>

</body>
</html>