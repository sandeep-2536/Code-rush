<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title data-i18n="dashboard.page_title">AAROHI | Dashboard</title>
    <link rel="stylesheet" href="/css/output.css">
    <style>
        /* Smooth gradient background for a modern feel */
        body { background: linear-gradient(180deg, #f0fdf4 0%, #f8fafc 100%); }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        /* Hide scrollbar for weather forecast horizontal scroll */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>

<body class="min-h-screen text-slate-800 font-sans">

<%- include("../layouts/header") %>

<div class="max-w-7xl mx-auto px-4 py-8">

    <header class="mb-8">
        <h1 class="text-3xl font-bold flex items-center gap-3 text-slate-700">
            <span>ğŸ‘¨â€ğŸŒ¾</span> 
            <span><span data-i18n="dashboard.welcome">Namaste</span>, <span class="text-green-700"><%= user.name %></span>!</span>
        </h1>
        <p class="text-slate-500 ml-10">Here is your farm's daily summary.</p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
        
        <div class="glass-card rounded-2xl shadow-sm border border-slate-100 p-6 flex flex-col justify-center">
            <div class="flex items-center gap-5 mb-4">
                <img src="<%= user.profileImage || '/images/default-farmer.png' %>" class="w-20 h-20 rounded-full border-4 border-green-50 object-cover shadow-sm">
                <div>
                    <h2 class="text-xl font-bold text-slate-800"><%= user.name %></h2>
                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full font-semibold uppercase"><%= user.farmerType %></span>
                </div>
            </div>
            <div class="space-y-2 text-sm text-slate-600 bg-slate-50 p-4 rounded-xl">
                <p>ğŸ“± <b>Mobile:</b> <%= user.mobileNumber %></p>
                <p>ğŸ“ <b>Location:</b> <%= user.village || "Not set" %>, <%= user.state %></p>
            </div>
        </div>

        <div class="lg:col-span-2 bg-gradient-to-br from-green-600 to-green-800 rounded-2xl shadow-lg text-white p-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-white opacity-10 rounded-full blur-2xl"></div>

            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2 opacity-90">
                â˜ï¸ Weather & AI Farm Advisory
            </h2>

            <div class="flex flex-col md:flex-row gap-6">
                <div class="flex-1">
                    <% if (weather && weather.length > 0) { %>
                        <div class="flex gap-3 overflow-x-auto hide-scroll pb-2">
                            <% weather.forEach((day, index) => { %>
                                <div class="flex-shrink-0 w-20 bg-white/20 backdrop-blur-sm rounded-xl p-3 text-center border border-white/10 <%= index === 0 ? 'bg-white/30 font-bold' : '' %>">
                                    <p class="text-xs opacity-80 mb-1"><%= day.date %></p>
                                    <img src="http://openweathermap.org/img/wn/<%= day.icon %>.png" class="w-10 h-10 mx-auto" alt="icon">
                                    <p class="text-lg font-bold"><%= day.temp %>Â°</p>
                                </div>
                            <% }) %>
                        </div>
                    <% } else { %>
                        <div class="bg-white/10 rounded-xl p-4 text-center">
                            <p>Weather data unavailable. Please update location.</p>
                        </div>
                    <% } %>
                </div>

                <div class="flex-1 bg-white text-slate-800 rounded-xl p-4 shadow-lg border-l-4 border-yellow-400">
                    <div class="flex items-center gap-2 mb-2">
                        <span class="animate-pulse text-yellow-500">âœ¨</span>
                        <h3 class="font-bold text-sm uppercase text-slate-500">AI Suggestion</h3>
                    </div>
                    <div class="text-sm leading-relaxed text-slate-700 prose-ul:list-disc prose-ul:pl-4">
                        <%- aiAdvice || "AI is analyzing weather data..." %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 class="text-xl font-bold mb-4 text-slate-700">ğŸ“Š Farm Statistics</h2>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-10">
        <% 
        const stats = [
            { count: myCommunityPosts.length, label: "My Posts", color: "green", icon: "ğŸŒ¿" },
            { count: myComments.length, label: "Comments", color: "blue", icon: "ğŸ’¬" },
            { count: myProblems.length, label: "Problems", color: "orange", icon: "ğŸ†˜" },
            { count: myAnimals.length, label: "Animals", color: "red", icon: "ğŸ„" },
            { count: myCrops.length, label: "Crops", color: "yellow", icon: "ğŸŒ¾" },
            { count: myVetCalls.length, label: "Vet Calls", color: "purple", icon: "ğŸ®" },
            { count: myAISearches.length, label: "AI Queries", color: "pink", icon: "ğŸ¤–" },
            { count: myStockViews.length, label: "Stock Checks", color: "gray", icon: "ğŸ“¦" }
        ];
        %>

        <% stats.forEach(stat => { %>
            <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 hover:shadow-md transition-all duration-300 hover:-translate-y-1">
                <div class="flex justify-between items-start">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-800"><%= stat.count %></h2>
                        <p class="text-sm font-medium text-slate-500"><%= stat.label %></p>
                    </div>
                    <div class="bg-<%= stat.color %>-50 p-2 rounded-lg text-xl">
                        <%= stat.icon %>
                    </div>
                </div>
            </div>
        <% }) %>
    </div>

    <h2 class="text-xl font-bold mb-4 text-slate-700">ğŸš€ Quick Actions</h2>
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 mb-10">
        
        <% 
        const navItems = [
            { link: "/community", label: "Community", icon: "ğŸŒ¿", color: "hover:bg-green-50 hover:border-green-200" },
            { link: "/community/chat", label: "Group Chat", icon: "ğŸ’¬", color: "hover:bg-blue-50 hover:border-blue-200" },
            { link: "/community", label: "Report Issue", icon: "ğŸ†˜", color: "hover:bg-orange-50 hover:border-orange-200" },
            { link: "/animals", label: "Sell Animals", icon: "ğŸ„", color: "hover:bg-red-50 hover:border-red-200" },
            { link: "/crops", label: "Sell Crops", icon: "ğŸŒ¾", color: "hover:bg-yellow-50 hover:border-yellow-200" },
            { link: "/stock", label: "Check Stock", icon: "ğŸ“¦", color: "hover:bg-gray-50 hover:border-gray-200" },
            { link: "/teleVet", label: "Call Vet", icon: "ğŸ©º", color: "hover:bg-purple-50 hover:border-purple-200" },
            { link: "/ai/assistant", label: "Ask AI", icon: "ğŸ¤–", color: "hover:bg-pink-50 hover:border-pink-200" }
        ];
        %>

        <% navItems.forEach(item => { %>
            <a href="<%= item.link %>" class="group bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-3 transition-all duration-200 <%= item.color %>">
                <span class="text-2xl group-hover:scale-110 transition-transform"><%= item.icon %></span>
                <span class="font-semibold text-slate-700"><%= item.label %></span>
            </a>
        <% }) %>
    </div>

    <h2 class="text-xl font-bold mb-4 text-slate-700">ğŸ“Œ Recent Activity</h2>
    <div class="space-y-3">
        <% if(recentActivity.length === 0) { %>
            <p class="text-slate-400 text-center py-8">No recent activity found.</p>
        <% } %>

        <% recentActivity.forEach(a => { %>
            <a href="<%= a.url %>" class="block bg-white p-4 rounded-xl shadow-sm border border-slate-100 hover:shadow-md hover:border-green-200 transition duration-300">
                <div class="flex items-center gap-4">
                    <div class="bg-slate-50 w-10 h-10 flex items-center justify-center rounded-full text-lg">
                        <% if (a.type === 'problem') { %> ğŸ†˜ 
                        <% } else if (a.type === 'animal') { %> ğŸ„ 
                        <% } else if (a.type === 'crop') { %> ğŸŒ¾ 
                        <% } else if (a.type === 'post') { %> ğŸŒ¿ 
                        <% } else if (a.type === 'comment') { %> ğŸ’¬ 
                        <% } else if (a.type === 'vet') { %> ğŸ©º 
                        <% } else { %> ğŸ“Œ <% } %>
                    </div>
                    <div class="flex-1">
                        <p class="font-medium text-slate-800"><%= a.text %></p>
                        <p class="text-xs text-slate-400"><%= new Date(a.date).toLocaleString() %></p>
                    </div>
                    <div class="text-slate-300">â€º</div>
                </div>
            </a>
        <% }) %>
    </div>

</div>

<%- include("../layouts/footer") %>

</body>
</html>