<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Call with Dr. <%= vet.name %> - Aarohi</title>
    <link rel="stylesheet" href="/css/output.css">
</head>
<body class="bg-gray-900">
    <%- include('../layouts/header') %>

    <div class="min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-teal-900">
        <div class="max-w-7xl mx-auto px-4 py-6">

            <!-- Header Info -->
            <div class="mb-6">
                <div class="bg-white/10 backdrop-blur-md rounded-2xl px-6 py-4 border border-white/20">
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div>
                            <h1 class="text-2xl md:text-3xl font-bold text-white mb-1 flex items-center gap-2">
                                ðŸ“ž Video Consultation
                            </h1>
                            <p class="text-blue-200">Calling <span class="font-semibold">Dr. <%= vet.name %></span></p>
                            <p class="text-sm text-blue-300">Specialization: <%= vet.specialization %></p>
                        </div>
                        
                        <!-- Call Status -->
                        <div class="inline-flex items-center gap-2 bg-green-500/20 backdrop-blur-sm px-4 py-2 rounded-full border border-green-400/30">
                            <span class="relative flex h-3 w-3">
                                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                                <span class="relative inline-flex rounded-full h-3 w-3 bg-green-400"></span>
                            </span>
                            <span id="callStatus" class="font-bold text-green-300">Connecting...</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Video Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                
                <!-- Remote Video (Doctor) -->
                <div class="relative bg-gray-800 rounded-3xl overflow-hidden shadow-2xl border-2 border-white/10">
                    <video id="remoteVideo" autoplay playsinline 
                           class="w-full h-[400px] lg:h-[500px] object-cover bg-gray-900"></video>
                    
                    <!-- Doctor Label -->
                    <div class="absolute top-4 left-4 bg-blue-600/90 backdrop-blur-sm px-4 py-2 rounded-full border border-blue-400/30">
                        <p class="text-white font-bold flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                            Dr. <%= vet.name %>
                        </p>
                    </div>

                    <!-- No Video Placeholder -->
                    <div class="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-blue-900 to-teal-900 opacity-0 pointer-events-none" id="remotePlaceholder">
                        <div class="text-center">
                            <div class="w-24 h-24 bg-blue-600 rounded-full mx-auto mb-4 flex items-center justify-center">
                                <svg class="w-12 h-12 text-white" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <p class="text-white text-lg font-semibold">Waiting for doctor...</p>
                        </div>
                    </div>
                </div>

                <!-- Local Video (You) -->
                <div class="relative bg-gray-800 rounded-3xl overflow-hidden shadow-2xl border-2 border-white/10">
                    <video id="localVideo" autoplay muted playsinline 
                           class="w-full h-[400px] lg:h-[500px] object-cover bg-gray-900 scale-x-[-1]"></video>
                    
                    <!-- Your Label -->
                    <div class="absolute top-4 left-4 bg-green-600/90 backdrop-blur-sm px-4 py-2 rounded-full border border-green-400/30">
                        <p class="text-white font-bold flex items-center gap-2">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                            </svg>
                            You
                        </p>
                    </div>
                </div>

            </div>

            <!-- Control Panel -->
            <div class="bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20">
                
                <div class="flex flex-wrap items-center justify-center gap-4">

                    <!-- Mute Button -->
                    <button id="muteBtn" 
                            class="flex items-center justify-center gap-3 bg-gray-700 hover:bg-gray-600 text-white px-6 py-4 rounded-2xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-300 min-w-[140px]">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z" clip-rule="evenodd"/>
                        </svg>
                        <span>Mute</span>
                    </button>

                    <!-- Camera Button -->
                    <button id="cameraBtn" 
                            class="flex items-center justify-center gap-3 bg-gray-700 hover:bg-gray-600 text-white px-6 py-4 rounded-2xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-300 min-w-[180px]">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 6a2 2 0 012-2h6a2 2 0 012 2v8a2 2 0 01-2 2H4a2 2 0 01-2-2V6zM14.553 7.106A1 1 0 0014 8v4a1 1 0 00.553.894l2 1A1 1 0 0018 13V7a1 1 0 00-1.447-.894l-2 1z"/>
                        </svg>
                        <span>Camera Off</span>
                    </button>

                    <!-- End Call Button -->
                    <button id="endCallBtn" 
                            class="flex items-center justify-center gap-3 bg-gradient-to-r from-red-500 to-rose-500 hover:from-red-600 hover:to-rose-600 text-white px-8 py-4 rounded-2xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 transition-all duration-300 min-w-[160px]">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 3a1 1 0 011-1h2.153a1 1 0 01.986.836l.74 4.435a1 1 0 01-.54 1.06l-1.548.773a11.037 11.037 0 006.105 6.105l.774-1.548a1 1 0 011.059-.54l4.435.74a1 1 0 01.836.986V17a1 1 0 01-1 1h-2C7.82 18 2 12.18 2 5V3z"/>
                        </svg>
                        <span>End Call</span>
                    </button>

                </div>

                <!-- Call Tips -->
                <div class="mt-6 pt-6 border-t border-white/20">
                    <div class="flex items-start gap-3 text-blue-200">
                        <svg class="w-5 h-5 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
                        </svg>
                        <div class="text-sm">
                            <p class="font-semibold mb-1">Call Tips:</p>
                            <ul class="space-y-1 text-blue-300">
                                <li>â€¢ Find a quiet place with good lighting</li>
                                <li>â€¢ Describe your animal's symptoms clearly</li>
                                <li>â€¢ Have any medical records ready if available</li>
                            </ul>
                        </div>
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>

    <div id="teleVetConfig" style="display:none"
         data-role="farmer"
         data-farmer-id="<%= farmer._id %>"
         data-farmer-name="<%= farmer.name %>"
         data-vet-id="<%= vet._id %>"
         data-vet-name="<%= vet.name %>">
    </div>

    <script src="/js/teleVetFarmerCall.js"></script>

    <%- include('../layouts/footer') %>
</body>
</html>